<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antigravity Multi-Account Cockpit</title>
    <!-- Bootstrap Icons CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        /* ============================================================
           NEO-BRUTALISM DESIGN SYSTEM
           High-contrast, thick borders, hard shadows, bold typography
           ============================================================ */
        :root {
            --nb-black: #1a1a2e;
            --nb-white: #ffffff;
            --nb-yellow: #FFE600;
            --nb-cyan: #00E5FF;
            --nb-pink: #FF2D6F;
            --nb-green: #39FF14;
            --nb-orange: #FF6B2B;
            --nb-purple: #A855F7;
            --nb-blue: #3B82F6;
            --nb-red: #EF4444;

            --nb-bg: #F0F0F0;
            --nb-card-bg: #FFFFFF;
            --nb-border: 3px solid var(--nb-black);
            --nb-shadow: 5px 5px 0px var(--nb-black);
            --nb-shadow-sm: 3px 3px 0px var(--nb-black);
            --nb-shadow-none: 0px 0px 0px var(--nb-black);
            --nb-radius: 4px;
            --nb-font: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;

            --nb-text: var(--nb-black);
            --nb-text-muted: #555;
        }

        /* Respect VS Code dark themes */
        body.vscode-dark, body.vscode-high-contrast {
            --nb-bg: #16162a;
            --nb-card-bg: #1e1e3a;
            --nb-black: #000000;
            --nb-text: #f0f0f0;
            --nb-text-muted: #aaa;
            --nb-border: 3px solid #f0f0f0;
            --nb-shadow: 5px 5px 0px #f0f0f0;
            --nb-shadow-sm: 3px 3px 0px #f0f0f0;
            --nb-shadow-none: 0px 0px 0px #f0f0f0;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: var(--nb-font);
            padding: 16px;
            margin: 0;
            color: var(--nb-text);
            background-color: var(--nb-bg);
            line-height: 1.5;
            overflow-x: hidden;
        }

        /* ======================== HEADER ======================== */
        .header {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .header-top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
        }

        .header-bottom-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            padding: 6px 0;
            flex-wrap: wrap;
        }

        .header-title-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header h1 {
            margin: 0;
            font-size: 26px;
            font-weight: 900;
            letter-spacing: -1px;
            text-transform: uppercase;
            color: var(--nb-text);
            background: var(--nb-yellow);
            display: inline-block;
            padding: 6px 16px;
            border: var(--nb-border);
            box-shadow: var(--nb-shadow-sm);
            border-radius: var(--nb-radius);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* ======================== BUTTONS ======================== */
        button {
            padding: 8px 16px;
            cursor: pointer;
            border: var(--nb-border);
            border-radius: var(--nb-radius);
            background: var(--nb-card-bg);
            color: var(--nb-text);
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: var(--nb-shadow-sm);
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            font-family: var(--nb-font);
        }

        button:hover {
            filter: brightness(1.05);
        }

        button:active {
            transform: translate(3px, 3px);
            box-shadow: var(--nb-shadow-none);
        }

        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
            box-shadow: var(--nb-shadow-sm);
        }

        button.teal {
            background: var(--nb-cyan);
            color: var(--nb-black);
        }

        button.blue {
            background: var(--nb-blue);
            color: var(--nb-white);
        }

        button.secondary {
            background: var(--nb-card-bg);
            color: var(--nb-text);
        }

        button.danger {
            background: var(--nb-pink);
            color: var(--nb-white);
        }

        button.danger:hover {
            background: #e6195c;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            flex-wrap: nowrap;
        }

        /* ======================== VIEW TOGGLE ======================== */
        .view-toggle {
            display: flex;
            border: var(--nb-border);
            border-radius: var(--nb-radius);
            overflow: hidden;
            box-shadow: var(--nb-shadow-sm);
        }

        .view-toggle-btn {
            padding: 8px 18px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--nb-text);
            background: var(--nb-card-bg);
            transition: transform 0.1s ease, background 0.1s ease;
            border-right: var(--nb-border);
            user-select: none;
        }

        .view-toggle-btn:last-child {
            border-right: none;
        }

        .view-toggle-btn.active {
            background: var(--nb-yellow);
            color: var(--nb-black);
        }

        .view-toggle-btn:active {
            transform: scale(0.95);
        }

        /* ======================== TABS ======================== */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            overflow-x: auto;
            padding: 4px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .tabs::-webkit-scrollbar { display: none; }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-radius: var(--nb-radius);
            background: var(--nb-card-bg);
            color: var(--nb-text);
            white-space: nowrap;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            border: var(--nb-border);
            box-shadow: var(--nb-shadow-sm);
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            user-select: none;
        }

        .tab:hover {
            background: var(--nb-yellow);
            color: var(--nb-black);
        }

        .tab:active {
            transform: translate(3px, 3px);
            box-shadow: var(--nb-shadow-none);
        }

        .tab.active {
            background: var(--nb-cyan);
            color: var(--nb-black);
            box-shadow: var(--nb-shadow);
        }

        .tab.active:active {
            transform: translate(5px, 5px);
            box-shadow: var(--nb-shadow-none);
        }

        /* ======================== BADGE ======================== */
        .badge {
            font-size: 10px;
            padding: 3px 10px;
            border-radius: var(--nb-radius);
            background: var(--nb-green);
            color: var(--nb-black);
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-left: 8px;
            border: 2px solid var(--nb-black);
        }

        body.vscode-dark .badge,
        body.vscode-high-contrast .badge {
            border-color: #f0f0f0;
        }

        /* ======================== ACCOUNT PANEL ======================== */
        .account-panel {
            display: none;
            border: var(--nb-border);
            border-radius: var(--nb-radius);
            padding: 16px;
            background: var(--nb-card-bg);
            box-shadow: var(--nb-shadow);
            animation: bruteFadeIn 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .account-panel::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 6px;
            background: repeating-linear-gradient(
                90deg,
                var(--nb-yellow) 0px,
                var(--nb-yellow) 20px,
                var(--nb-cyan) 20px,
                var(--nb-cyan) 40px,
                var(--nb-pink) 40px,
                var(--nb-pink) 60px
            );
        }

        @keyframes bruteFadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .account-panel.active {
            display: block;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            gap: 12px;
        }

        .account-info h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 900;
            text-transform: uppercase;
        }

        .account-info p {
            margin: 4px 0 0 0;
            color: var(--nb-text-muted);
            font-size: 13px;
            font-weight: 600;
        }

        /* ======================== QUOTA GRID ======================== */
        .quota-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .quota-card {
            padding: 14px;
            border-radius: var(--nb-radius);
            background: var(--nb-card-bg);
            border: var(--nb-border);
            box-shadow: var(--nb-shadow-sm);
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            position: relative;
        }

        .quota-card:hover {
            transform: translate(-2px, -2px);
            box-shadow: 7px 7px 0px var(--nb-black);
        }

        body.vscode-dark .quota-card:hover,
        body.vscode-high-contrast .quota-card:hover {
            box-shadow: 7px 7px 0px #f0f0f0;
        }

        .quota-card:active {
            transform: translate(3px, 3px);
            box-shadow: var(--nb-shadow-none);
        }

        .quota-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 800;
            font-size: 13px;
            text-transform: uppercase;
        }

        .progress-bar {
            height: 14px;
            background: #e0e0e0;
            border: 2px solid var(--nb-black);
            border-radius: var(--nb-radius);
            overflow: hidden;
            margin-bottom: 8px;
        }

        body.vscode-dark .progress-bar,
        body.vscode-high-contrast .progress-bar {
            background: #333;
            border-color: #f0f0f0;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.8s ease-out;
        }

        .quota-meta {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--nb-text-muted);
            margin-top: 8px;
            font-weight: 600;
        }

        /* ======================== LIST VIEW & TABLE ======================== */
        .list-view {
            display: none;
            width: 100%;
            overflow-x: auto;
        }

        .list-view.active {
            display: block;
        }

        .account-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            background: var(--nb-card-bg);
            border: var(--nb-border);
            box-shadow: var(--nb-shadow);
        }

        .account-table th {
            text-align: left;
            padding: 10px 12px;
            background: var(--nb-yellow);
            color: var(--nb-black);
            border-bottom: var(--nb-border);
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            font-size: 12px;
        }

        .account-table td {
            padding: 10px 12px;
            border-bottom: 2px solid var(--nb-black);
            vertical-align: middle;
            white-space: nowrap;
            font-weight: 600;
        }

        body.vscode-dark .account-table td,
        body.vscode-high-contrast .account-table td {
            border-bottom-color: #f0f0f0;
        }

        .account-table tr:hover td {
            background: rgba(0, 229, 255, 0.08);
        }

        .status-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 2px;
            border: 2px solid var(--nb-black);
        }

        body.vscode-dark .status-dot,
        body.vscode-high-contrast .status-dot {
            border-color: #f0f0f0;
        }

        .status-dot.active {
            background: var(--nb-green);
        }

        .status-dot.inactive {
            background: #ccc;
        }

        /* ======================== MODALS ======================== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: var(--nb-card-bg);
            border: var(--nb-border);
            border-radius: var(--nb-radius);
            width: 90%;
            max-width: 680px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 8px 8px 0px var(--nb-black);
            display: flex;
            flex-direction: column;
        }

        body.vscode-dark .modal,
        body.vscode-high-contrast .modal {
            box-shadow: 8px 8px 0px #f0f0f0;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--nb-purple);
            color: var(--nb-white);
            border-bottom: var(--nb-border);
        }

        .modal-header h2 {
            margin: 0;
            font-size: 18px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .modal-close {
            background: var(--nb-white);
            color: var(--nb-black);
            font-size: 18px;
            padding: 2px 10px;
            border-radius: var(--nb-radius);
            min-width: auto;
            border: 2px solid var(--nb-black);
            box-shadow: 2px 2px 0px var(--nb-black);
        }

        .modal-close:hover {
            background: var(--nb-pink);
            color: var(--nb-white);
        }

        .modal-close:active {
            transform: translate(2px, 2px);
            box-shadow: 0 0 0 var(--nb-black);
        }

        .modal-body {
            padding: 16px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 12px 16px;
            background: var(--nb-card-bg);
            border-top: var(--nb-border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* ======================== GROUP MANAGEMENT ======================== */
        .info-tip {
            background: var(--nb-yellow);
            border: var(--nb-border);
            border-radius: var(--nb-radius);
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 13px;
            font-weight: 700;
            color: var(--nb-black);
            display: flex;
            align-items: flex-start;
            gap: 10px;
            box-shadow: var(--nb-shadow-sm);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .groups-section-title {
            font-size: 14px;
            font-weight: 900;
            margin-bottom: 10px;
            color: var(--nb-text);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--nb-text);
            padding-bottom: 6px;
        }

        .groups-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .group-card {
            background: var(--nb-card-bg);
            border: var(--nb-border);
            border-radius: var(--nb-radius);
            padding: 12px 16px;
            box-shadow: var(--nb-shadow-sm);
            transition: transform 0.1s ease, box-shadow 0.1s ease;
        }

        .group-card:hover {
            transform: translate(-1px, -1px);
            box-shadow: 6px 6px 0px var(--nb-black);
        }

        body.vscode-dark .group-card:hover,
        body.vscode-high-contrast .group-card:hover {
            box-shadow: 6px 6px 0px #f0f0f0;
        }

        .group-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .group-name {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 800;
        }

        .group-name-input {
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--nb-text);
            font-size: 15px;
            font-weight: 800;
            padding: 4px 2px;
            width: 200px;
            font-family: var(--nb-font);
            transition: border-color 0.2s;
        }

        .group-name-input:focus {
            outline: none;
            border-bottom-color: var(--nb-cyan);
        }

        .group-danger {
            background: var(--nb-pink);
            border: 2px solid var(--nb-black);
            color: var(--nb-white);
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            padding: 4px 12px;
            border-radius: var(--nb-radius);
            box-shadow: 2px 2px 0px var(--nb-black);
            transition: transform 0.1s ease, box-shadow 0.1s ease;
        }

        body.vscode-dark .group-danger,
        body.vscode-high-contrast .group-danger {
            border-color: #f0f0f0;
            box-shadow: 2px 2px 0px #f0f0f0;
        }

        .group-danger:hover {
            background: #e6195c;
        }

        .group-danger:active {
            transform: translate(2px, 2px);
            box-shadow: 0 0 0 var(--nb-black);
        }

        .model-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
        }

        .model-tag {
            background: var(--nb-cyan);
            color: var(--nb-black);
            border: 2px solid var(--nb-black);
            border-radius: var(--nb-radius);
            padding: 4px 12px;
            font-size: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 2px 2px 0px var(--nb-black);
            transition: transform 0.1s ease, box-shadow 0.1s ease;
        }

        body.vscode-dark .model-tag,
        body.vscode-high-contrast .model-tag {
            border-color: #f0f0f0;
            box-shadow: 2px 2px 0px #f0f0f0;
        }

        .model-tag:hover {
            transform: translate(-1px, -1px);
            box-shadow: 3px 3px 0px var(--nb-black);
        }

        body.vscode-dark .model-tag:hover,
        body.vscode-high-contrast .model-tag:hover {
            box-shadow: 3px 3px 0px #f0f0f0;
        }

        .model-tag-remove {
            cursor: pointer;
            opacity: 0.7;
            font-size: 16px;
            font-weight: 900;
        }

        .model-tag-remove:hover {
            opacity: 1;
            color: var(--nb-pink);
        }

        .add-model-btn {
            background: var(--nb-card-bg);
            border: 3px dashed var(--nb-text);
            color: var(--nb-text);
            border-radius: var(--nb-radius);
            padding: 4px 14px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            transition: transform 0.1s ease, background 0.1s ease;
            box-shadow: none;
        }

        .add-model-btn:hover {
            background: var(--nb-yellow);
            color: var(--nb-black);
            border-color: var(--nb-black);
        }

        .add-model-btn:active {
            transform: translate(2px, 2px);
        }

        .model-dropdown {
            position: relative;
            display: inline-block;
        }

        .model-dropdown-content {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 0;
            background: var(--nb-card-bg);
            border: var(--nb-border);
            border-radius: var(--nb-radius);
            min-width: 220px;
            max-height: 240px;
            overflow-y: auto;
            z-index: 1001;
            box-shadow: var(--nb-shadow);
            margin-bottom: 6px;
        }

        .model-dropdown-content.show { display: block; }

        .model-dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: var(--nb-text);
            border-bottom: 2px solid var(--nb-black);
            transition: background 0.1s;
        }

        body.vscode-dark .model-dropdown-item,
        body.vscode-high-contrast .model-dropdown-item {
            border-bottom-color: #f0f0f0;
        }

        .model-dropdown-item:last-child {
            border-bottom: none;
        }

        .model-dropdown-item:hover {
            background: var(--nb-yellow);
            color: var(--nb-black);
        }

        .model-dropdown-item.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .model-dropdown-item.disabled:hover {
            background: transparent;
            color: var(--nb-text);
        }

        .empty-state {
            text-align: center;
            padding: 60px 24px;
            color: var(--nb-text-muted);
            font-weight: 700;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        /* ======================== QUOTA STATUS PANELS ======================== */
        .quota-empty-state {
            text-align: center;
            padding: 24px;
            border-radius: var(--nb-radius);
            border: var(--nb-border);
            margin-top: 20px;
            font-weight: 700;
            box-shadow: var(--nb-shadow-sm);
        }

        .quota-empty-state.error {
            background: var(--nb-pink);
            color: var(--nb-white);
        }

        .quota-empty-state.waiting {
            background: var(--nb-yellow);
            color: var(--nb-black);
        }

        .quota-empty-state .status-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .quota-empty-state .status-sub {
            font-size: 12px;
            margin-top: 8px;
            opacity: 0.85;
        }

        /* ======================== SELECT / FORM ELEMENTS ======================== */
        select {
            padding: 6px 10px;
            font-size: 13px;
            font-weight: 700;
            border: var(--nb-border);
            border-radius: var(--nb-radius);
            background: var(--nb-card-bg);
            color: var(--nb-text);
            box-shadow: var(--nb-shadow-sm);
            outline: none;
            cursor: pointer;
            font-family: var(--nb-font);
            appearance: auto;
        }

        select:focus {
            border-color: var(--nb-cyan);
        }

        /* ======================== INTERVAL LABEL ======================== */
        .interval-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 700;
            color: var(--nb-text-muted);
            text-transform: uppercase;
        }

        /* ======================== PANEL DELETE SECTION ======================== */
        .panel-delete-section {
            margin-top: 16px;
            padding-top: 14px;
            border-top: var(--nb-border);
            display: flex;
            justify-content: flex-end;
        }

        /* ======================== TIER BADGE ======================== */
        .tier-badge {
            display: inline-block;
            margin-top: 8px;
            padding: 3px 12px;
            font-size: 11px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 2px solid var(--nb-black);
            border-radius: var(--nb-radius);
            background: var(--nb-orange);
            color: var(--nb-black);
        }

        body.vscode-dark .tier-badge,
        body.vscode-high-contrast .tier-badge {
            border-color: #f0f0f0;
        }

        .list-tier-badge {
            padding: 3px 10px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            border: 2px solid var(--nb-black);
            border-radius: var(--nb-radius);
            background: var(--nb-orange);
            color: var(--nb-black);
        }

        body.vscode-dark .list-tier-badge,
        body.vscode-high-contrast .list-tier-badge {
            border-color: #f0f0f0;
        }

        .list-active-label {
            font-size: 12px;
            color: var(--nb-green);
            font-weight: 900;
            margin-right: 10px;
            text-transform: uppercase;
        }

        /* ======================== RESPONSIVE ======================== */
        @media (max-width: 560px) {
            .header-top-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            .header-bottom-row {
                flex-direction: column;
                align-items: flex-start;
            }
            .header h1 {
                font-size: 18px;
            }
            .header-actions {
                width: 100%;
            }
        }

        @media (max-width: 400px) {
            body { padding: 8px; }
            .header h1 { font-size: 16px; padding: 4px 10px; }
            .quota-grid { grid-template-columns: 1fr; }
            .panel-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .btn-group {
                width: 100%;
                justify-content: flex-start;
            }
            .btn-group button {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-top-row">
            <div class="header-title-section">
                <h1><i class="bi bi-rocket-takeoff-fill"></i> AG Cockpit</h1>
            </div>
            <div class="view-toggle">
                <div class="view-toggle-btn active" id="btnViewTab" onclick="switchView('tab')"><i class="bi bi-grid-fill"></i> Kartu</div>
                <div class="view-toggle-btn" id="btnViewList" onclick="switchView('list')"><i class="bi bi-list-ul"></i> Daftar</div>
            </div>
        </div>

        <div class="header-bottom-row">
            <div class="header-actions">
                <button class="teal" onclick="openGroupManager()"><i class="bi bi-collection-fill"></i> Manajemen Grup</button>
                <button class="blue" onclick="addAccount()"><i class="bi bi-person-plus-fill"></i> Tambah Akun</button>
                <button class="secondary" onclick="refreshAll()"><i class="bi bi-arrow-clockwise"></i> Refresh Semua</button>
            </div>
            <div class="header-actions">
                <label class="interval-label">
                    <i class="bi bi-clock-fill"></i> Interval:
                    <select id="refreshIntervalSelect" onchange="updateRefreshInterval()">
                        <option value="1">1 menit</option>
                        <option value="2">2 menit</option>
                        <option value="5">5 menit</option>
                        <option value="10">10 menit</option>
                        <option value="15">15 menit</option>
                        <option value="30">30 menit</option>
                        <option value="60">60 menit</option>
                    </select>
                </label>
            </div>
        </div>
    </div>

    <!-- Tab View Container -->
    <div id="tabViewContainer">
        <div class="tabs" id="tabContainer"></div>
        <div id="panelContainer"></div>
    </div>

    <!-- List View Container -->
    <div id="listViewContainer" class="list-view">
        <table class="account-table">
            <thead>
                <tr>
                    <th style="width: 24px;">#</th>
                    <th>Akun (Email)</th>
                    <th>Nama</th>
                    <th>Tingkat</th>
                    <th>Terakhir Aktif</th>
                    <th style="text-align: right; width: 160px;">Aksi</th>
                </tr>
            </thead>
            <tbody id="accountTableBody">
                <!-- Rendered dynamically -->
            </tbody>
        </table>
    </div>

    <!-- Group Management Modal -->
    <div class="modal-overlay" id="groupModal">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="bi bi-collection-fill"></i> Manajemen Grup</h2>
                <button class="modal-close" onclick="closeGroupManager()"><i class="bi bi-x-lg"></i></button>
            </div>
            <div class="modal-body">
                <div class="action-buttons">
                    <button class="teal" onclick="autoGroup()"><i class="bi bi-magic"></i> Pengelompokan Otomatis</button>
                    <button class="secondary" onclick="addNewGroup()"><i class="bi bi-plus-circle-fill"></i> Tambah Grup</button>
                </div>

                <div class="groups-section-title"><i class="bi bi-list-stars"></i> Daftar Grup</div>
                <div class="groups-list" id="groupsList">
                    <!-- Groups rendered dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary" onclick="closeGroupManager()"><i class="bi bi-x-circle"></i> Batal</button>
                <button class="blue" onclick="saveGroups()"><i class="bi bi-floppy-fill"></i> Simpan Grup</button>
            </div>
        </div>
    </div>

    <script>
        const vscode = acquireVsCodeApi();
        const state = vscode.getState() || {};
        let currentView = state.currentView || 'tab';
        const accounts = /*{{ACCOUNTS_JSON}}*/[];
        let groupsConfig = /*{{GROUPS_JSON}}*/{};

        // Prefer activeAccountId from state to preserve selection across refreshes
        let activeAccountId = state.activeAccountId;
        if (!activeAccountId || !accounts.find(a => a.id === activeAccountId)) {
            activeAccountId = accounts.find(a => a.isCurrent)?.id || accounts[0]?.id;
        }

        let activeDropdownId = null;

        // Get all available models
        function getAllModels() {
            const models = [];
            accounts.forEach(acc => {
                if (acc.quota && acc.quota.models) {
                    acc.quota.models.forEach(m => {
                        if (!models.find(x => x.name === m.name)) {
                            models.push({
                                name: m.name,
                                resetTime: m.reset_time || '',
                                percentage: m.percentage
                            });
                        }
                    });
                }
            });
            return models;
        }

        // Get grouped model names
        function getGroupedModels() {
            const grouped = new Set();
            groupsConfig.groups.forEach(g => {
                g.models.forEach(m => grouped.add(m));
            });
            return grouped;
        }

        // Update refresh interval
        function updateRefreshInterval() {
            const select = document.getElementById('refreshIntervalSelect');
            const value = parseInt(select.value, 10);
            vscode.postMessage({ command: 'setRefreshInterval', value: value });
        }

        // Listen for extension messages
        window.addEventListener('message', event => {
            const message = event.data;
            if (message.command === 'groupsConfig') {
                groupsConfig = message.config;
                renderGroupsList();
            } else if (message.command === 'refreshIntervalValue') {
                const select = document.getElementById('refreshIntervalSelect');
                if (select) {
                    select.value = message.value.toString();
                }
            }
        });

        // Request current refresh interval on init
        vscode.postMessage({ command: 'getRefreshInterval' });

        function switchView(view) {
            currentView = view;
            vscode.setState({ ...state, currentView: view });
            updateViewUI();
        }

        function updateViewUI() {
            const tabContainer = document.getElementById('tabViewContainer');
            const listContainer = document.getElementById('listViewContainer');
            const btnTab = document.getElementById('btnViewTab');
            const btnList = document.getElementById('btnViewList');

            if (currentView === 'tab') {
                tabContainer.style.display = 'block';
                listContainer.classList.remove('active');
                btnTab.classList.add('active');
                btnList.classList.remove('active');
            } else {
                tabContainer.style.display = 'none';
                listContainer.classList.add('active');
                btnTab.classList.remove('active');
                btnList.classList.add('active');
                renderListView();
            }
        }

        function deleteAccount(id, email) {
            vscode.postMessage({
                command: 'delete',
                accountId: id,
                email: email
            });
        }

        function renderListView() {
            const tbody = document.getElementById('accountTableBody');
            tbody.innerHTML = '';

            if (accounts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:30px;font-weight:700;">Belum ada akun, silakan klik tombol di kanan atas untuk menambahkan.</td></tr>';
                return;
            }

            accounts.forEach(acc => {
                const tr = document.createElement('tr');
                if (acc.isCurrent) tr.className = 'current-account';

                const lastUsedDate = new Date(acc.last_used);
                const lastUsedStr = lastUsedDate.toLocaleString('id-ID', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });

                const statusDotClass = acc.isCurrent ? 'active' : 'inactive';
                const statusTitle = acc.isCurrent ? 'Saat ini aktif' : 'Tidak aktif';

                const subTier = (acc.quota && acc.quota.tier) ? acc.quota.tier : '-';

                tr.innerHTML = `
                    <td><span class="status-dot ${statusDotClass}" title="${statusTitle}"></span></td>
                    <td>${acc.email}</td>
                    <td>${acc.name || '-'}</td>
                    <td><span class="list-tier-badge">${subTier}</span></td>
                    <td style="font-size:12px;">${lastUsedStr}</td>
                    <td style="text-align: right;">
                        <div class="btn-group" style="justify-content: flex-end;">
                            ${!acc.isCurrent ? `<button class="teal" onclick="switchAccount('${acc.id}', '${acc.email}')"><i class="bi bi-arrow-left-right"></i> Beralih</button>` : '<span class="list-active-label"><i class="bi bi-check-circle-fill"></i> Digunakan</span>'}
                            <button class="secondary" onclick="refreshAccount('${acc.id}')"><i class="bi bi-arrow-clockwise"></i></button>
                            <button class="danger" onclick="deleteAccount('${acc.id}', '${acc.email}')"><i class="bi bi-trash3-fill"></i></button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function render() {
            const tabContainer = document.getElementById('tabContainer');
            const panelContainer = document.getElementById('panelContainer');

            tabContainer.innerHTML = '';
            panelContainer.innerHTML = '';

            // Render Tabs
            accounts.forEach(acc => {
                const tab = document.createElement('div');
                tab.className = 'tab' + (acc.id === activeAccountId ? ' active' : '');
                const shortEmail = acc.email.split('@')[0];
                tab.innerHTML = `<span>${shortEmail}</span>${acc.isCurrent ? '<span class="badge">ACTIVE</span>' : ''}`;
                tab.onclick = () => {
                    activeAccountId = acc.id;
                    vscode.setState({ activeAccountId: activeAccountId });
                    render();
                };
                tabContainer.appendChild(tab);

                const panel = document.createElement('div');
                panel.className = 'account-panel' + (acc.id === activeAccountId ? ' active' : '');

                let quotaHtml = '';
                if (acc.quota && !acc.quota.is_forbidden) {
                    quotaHtml = '<div class="quota-grid">' + acc.quota.models.map(m => {
                        let color = '#39FF14'; // Green (OK)
                        let bgBar = '#39FF14';
                        if (m.percentage <= 20) { color = '#FF2D6F'; bgBar = '#FF2D6F'; } // Red/Pink (Critical)
                        else if (m.percentage <= 50) { color = '#FFE600'; bgBar = '#FFE600'; } // Yellow (Warning)

                        return `
                            <div class="quota-card">
                                <div class="quota-header">
                                    <span>${m.name}</span>
                                    <span style="color: ${color}; font-size:16px;">${m.percentage}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${m.percentage}%; background: ${bgBar};"></div>
                                </div>
                                <div class="quota-meta">
                                    <span><i class="bi bi-clock-history"></i> Waktu Reset</span>
                                    <span>${m.reset_time || 'Tidak diketahui'}</span>
                                </div>
                            </div>
                        `;
                    }).join('') + '</div>';
                } else {
                    if (acc.isCurrent) {
                        quotaHtml = `
                            <div class="quota-empty-state error">
                                <div class="status-icon"><i class="bi bi-exclamation-triangle-fill"></i></div>
                                <div>Belum ada data kuota (Token mungkin sudah kedaluwarsa atau izin dibatasi)</div>
                                <div class="status-sub">Silakan klik tombol "Refresh" di atas untuk mencoba lagi</div>
                            </div>`;
                    } else {
                        quotaHtml = `
                            <div class="quota-empty-state waiting">
                                <div class="status-icon"><i class="bi bi-hourglass-split"></i></div>
                                <div>Data kuota menunggu penyegaran</div>
                                <div class="status-sub">Untuk mengurangi risiko batas frekuensi API, panel ini hanya merefresh otomatis akun yang diaktifkan</div>
                                <div class="status-sub">Klik tombol "Refresh" di atas untuk mendapatkan kuota secara manual</div>
                            </div>`;
                    }
                }

                panel.innerHTML = `
                    <div class="panel-header">
                        <div class="account-info">
                            <h2>${acc.name || 'Akun Tanpa Nama'}</h2>
                            <p>${acc.email}</p>
                            ${acc.quota?.tier ? `<div><span class="tier-badge">${acc.quota.tier.toUpperCase()}</span></div>` : ''}
                        </div>
                        <div class="btn-group">
                            <button class="secondary" onclick="refreshAccount('${acc.id}')"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
                            <button onclick="switchAccount('${acc.id}', '${acc.email}')" ${acc.isCurrent ? 'disabled' : ''}>
                                <i class="bi bi-arrow-left-right"></i> ${acc.isCurrent ? 'Akun Utama' : 'Beralih ke Akun Ini'}
                            </button>
                        </div>
                    </div>
                    ${quotaHtml}
                    <div class="panel-delete-section">
                        <button class="danger" onclick="deleteAccount('${acc.id}', '${acc.email}')"><i class="bi bi-trash3-fill"></i> Hapus Akun Ini</button>
                    </div>
                `;
                panelContainer.appendChild(panel);
            });
            updateViewUI();
        }

        // Render groups list
        function renderGroupsList() {
            const container = document.getElementById('groupsList');
            const allModels = getAllModels();
            const groupedModels = getGroupedModels();

            if (groupsConfig.groups.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"><i class="bi bi-inbox-fill"></i></div>
                        <p>Belum ada grup, klik "Pengelompokan Otomatis" atau "Tambah Grup" untuk memulai</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = groupsConfig.groups.map((group, index) => `
                <div class="group-card" data-group-id="${group.id}">
                    <div class="group-card-header">
                        <div class="group-name">
                            <i class="bi bi-folder-fill"></i>
                            <input type="text" class="group-name-input" value="${group.name}"
                                onchange="updateGroupName('${group.id}', this.value)"
                                onclick="event.stopPropagation()">
                        </div>
                        <button class="group-danger" onclick="deleteGroup('${group.id}')"><i class="bi bi-trash3-fill"></i> Hapus</button>
                    </div>
                    <div class="model-tags">
                        ${group.models.map(modelName => `
                            <div class="model-tag">
                                <span>${modelName}</span>
                                <span class="model-tag-remove" onclick="removeModelFromGroup('${group.id}', '${modelName}')"><i class="bi bi-x-lg"></i></span>
                            </div>
                        `).join('')}
                        <div class="model-dropdown">
                            <button class="add-model-btn" onclick="toggleModelDropdown('${group.id}', event)"><i class="bi bi-plus-lg"></i> Tambah Model</button>
                            <div class="model-dropdown-content" id="dropdown-${group.id}">
                                ${allModels.filter(m => !group.models.includes(m.name)).map(m => `
                                    <div class="model-dropdown-item ${groupedModels.has(m.name) && !group.models.includes(m.name) ? 'disabled' : ''}"
                                        onclick="${groupedModels.has(m.name) && !group.models.includes(m.name) ? '' : `addModelToGroup('${group.id}', '${m.name}')`}">
                                        ${m.name}
                                        ${groupedModels.has(m.name) ? ' <i class="bi bi-lock-fill"></i>' : ''}
                                    </div>
                                `).join('')}
                                ${allModels.filter(m => !group.models.includes(m.name)).length === 0 ? '<div class="model-dropdown-item" style="opacity: 0.5"><i class="bi bi-emoji-frown"></i> Tidak ada model yang dapat ditambahkan</div>' : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Toggle model dropdown
        function toggleModelDropdown(groupId, event) {
            event.stopPropagation();
            const dropdown = document.getElementById('dropdown-' + groupId);

            // Close other dropdowns
            document.querySelectorAll('.model-dropdown-content').forEach(d => {
                if (d.id !== 'dropdown-' + groupId) {
                    d.classList.remove('show');
                }
            });

            dropdown.classList.toggle('show');
            activeDropdownId = dropdown.classList.contains('show') ? groupId : null;
        }

        // Close dropdown when clicking elsewhere
        document.addEventListener('click', () => {
            document.querySelectorAll('.model-dropdown-content').forEach(d => {
                d.classList.remove('show');
            });
            activeDropdownId = null;
        });

        // Open group manager modal
        function openGroupManager() {
            document.getElementById('groupModal').classList.add('active');
            renderGroupsList();
        }

        // Close group manager modal
        function closeGroupManager() {
            document.getElementById('groupModal').classList.remove('active');
        }

        // Auto group
        function autoGroup() {
            const models = getAllModels();
            vscode.postMessage({ command: 'autoGroup', models: models });
        }

        // Add new group
        function addNewGroup() {
            vscode.postMessage({ command: 'addGroup', groupName: 'Grup Baru' });
        }

        // Delete group
        function deleteGroup(groupId) {
            vscode.postMessage({ command: 'deleteGroup', groupId: groupId });
        }

        // Update group name
        function updateGroupName(groupId, newName) {
            vscode.postMessage({ command: 'updateGroupName', groupId: groupId, newName: newName });
        }

        // Add model to group
        function addModelToGroup(groupId, modelName) {
            vscode.postMessage({ command: 'addModelToGroup', groupId: groupId, modelName: modelName });
        }

        // Remove model from group
        function removeModelFromGroup(groupId, modelName) {
            vscode.postMessage({ command: 'removeModelFromGroup', groupId: groupId, modelName: modelName });
        }

        // Save groups
        function saveGroups() {
            vscode.postMessage({ command: 'saveGroups', config: groupsConfig });
            closeGroupManager();
        }

        // Listen for extension messages (duplicate handler kept for compatibility)
        window.addEventListener('message', event => {
            const message = event.data;
            if (message.command === 'groupsConfig') {
                groupsConfig = message.config;
                renderGroupsList();
            }
        });

        function switchAccount(id, email) {
            vscode.postMessage({ command: 'switch', accountId: id, email: email });
        }
        function refreshAccount(id) {
            vscode.postMessage({ command: 'refresh', accountId: id });
        }
        function refreshAll() {
            vscode.postMessage({ command: 'refreshAll' });
        }
        function addAccount() {
            vscode.postMessage({ command: 'addAccount' });
        }

        render();
    </script>
</body>
</html>